<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Station</title>
    <link rel="stylesheet" href="style.css">
    <!-- <script src="/scripts/API_comm.TS"></script> -->
</head>
<body>  
    <div class="weather-container">
        <div class="header">
            <h1 class="title">Weather Station</h1>
            <p class="subtitle">Local Weather Information</p>
            <h4 id="cityName"></h4>
            <p id="temperature"></p>
            <p id="visibility"></p>
            <p id="windSpeed"></p>
        </div>
        
        <div class="weather-display" id="weatherDisplay">

        </div>
    </div>

    <script type="text/typescript">
        const API_key='e2c22b27d1547f05ad9017996b513c40';
        const city_ID= "Veles";

        interface WeatherData {
        coord: {
            lon: number;
            lat: number;
        };
        weather: {
            id: number;
            main: string;
            description: string;
            icon: string;
        }[];
        base: string;
        main: {
            temp: number;
            feels_like: number;
            temp_min: number;
            temp_max: number;
            pressure: number;
            humidity: number;
            sea_level: number;
            grnd_level: number;
        };
        visibility: number;
        wind: {
            speed: number;
            deg: number;
            gust: number;
        };
        clouds: {
            all: number;
        };
        dt: number;
        sys: {
            country: string;
            sunrise: number;
            sunset: number;
        };
        timezone: number;
        id: number;
        name: string;
        cod: number;
        };

        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city_ID}&appid=${API_key}`);
        if (!response.ok) {
            throw new Error('something went wrong: ' + response.statusText);
        }
        const data: WeatherData = await response.json();
                
        const setText = (id: string, text: string): void => {
            const el = document.getElementById(id) as HTMLElement | null;
            if (el) el.textContent = text;
        };

        setText("cityName", data.name);
        setText("temperature", `${(data.main.temp - 273.15).toFixed(1)}Â°C`);
        setText("humidity", `${data.main.humidity}%`);
        setText("windSpeed", `${data.wind.speed} km/h`);
        setText("visibility", `${data.visibility} km`);

        const weatherDisplay = document.getElementById("weatherDisplay") as HTMLElement | null;
        if (weatherDisplay) {
            weatherDisplay.style.display = "block";
        }
    
    </script>
</body>
</html>